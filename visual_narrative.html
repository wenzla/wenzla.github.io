<!DOCTYPE html>
<!--

-->
<html>
	<head>
		<title> Visual Narrative </title>
		<script src="https://d3js.org/d3.v4.js"></script>
	</head>
	<body>
		<div id="viz"></div>
	</body>

	<script>
		// set the dimensions and margins of the graph
		var margin = {top: 10, right: 30, bottom: 30, left: 60},
			width = 1800 - margin.left - margin.right,
			height = 900 - margin.top - margin.bottom;
		// append the svg object to the body of the page
		var svg = d3.select("#viz")
		  .append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
		  .append("g")
			.attr("transform",
				  "translate(" + margin.left + "," + margin.top + ")");

		var data = d3.csv("https://raw.githubusercontent.com/wenzla/wenzla.github.io/master/data/japan_polling_all.csv", function(d) {
			d.forEach(function(dt) {
				//d3.timeParse("%Y-%m-%d")(d.date), value : d.value }
				dt['Fieldwork_date'] = d3.timeParse("%m/%e/%Y")(dt['Fieldwork_date']),
				dt['Polling_firm'] = dt['Polling_firm'],
				dt['CDP'] = +dt['CDP'],
				dt['DPP'] = +dt['DPP'],
				dt['Ishin'] = +dt['Ishin'],
				dt['JCP'] = +dt['JCP'],
				dt['LDP'] = +dt['LDP'],
				dt['N-Koku'] = +dt['N-Koku'],
				dt['NKP'] = +dt['NKP'],
				dt['No_party'] = +dt['No_party'],
				dt['Reiwa'] = +dt['Reiwa'],
				dt['SDP'] = +dt['SDP']
			});

			console.log(d)

			// x-axis
			var x = d3.scaleTime()
			.domain(d3.extent(d, function(dt) { return dt.Fieldwork_date;}))
			.range([ 0, width ]);
			svg.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(d3.axisBottom(x));

			// y-axis
			var y = d3.scaleLinear()
			.domain([0,100])
			.range([ height, 0 ]);
			svg.append("g")
			.call(d3.axisLeft(y));
			
			var cols_to_graph = ['LDP', 'CDP', 'NKP', 'JCP', 'Ishin', 'DPP', 'SDP', 'Reiwa', 'N-Koku', 'Others'];
			var colors = ['rgb(60,163,36)', 'rgb(24,69,137)', 'rgb(245,88,157)', 'rgb(219,0,28)', 'rgb(184,206,67)', 'rgb(255,215,0)', 'rgb(28,169,233)', 'rgb(237,0,140)', 'rgb(248,234,13)', 'rgb(234,236,240)']

			//tooltip: https://bl.ocks.org/d3noob/a22c42db65eb00d4e369

			cols_to_graph.forEach(function(item, ind) {
				// Add the line
				svg.append("path")
				.datum(d)
				.attr("fill", "none")
				.attr("stroke", colors[ind])
				.attr("stroke-width", 1.5)
				.attr("d", d3.line()
					.x(function(dt) { return x(dt.Fieldwork_date) })
					.y(function(dt) { return y(dt[item])})
					);

				svg.append("g")
				.selectAll("dot")
				.data(d)
				.enter()
				.append("circle")
					.attr("id", "circle_tooltip")
					.attr("cx", function(dt) { return x(dt.Fieldwork_date) } )
					.attr("cy", function(dt) { return y(dt[item]) } )
					.attr("r", 5)
					.attr("fill", colors[ind])

				d3.select
			});
			});

		</script>
</html>

